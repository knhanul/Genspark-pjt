# 🎯 AG Grid 기반 통합 가사 편집기 가이드

## 📋 개요

**LyricsGridEditor**는 AG Grid를 활용한 스프레드시트 스타일의 강력한 가사 편집 도구입니다.
가사 등록, 수정, 삭제, TSV 가져오기/내보내기를 하나의 화면에서 처리할 수 있습니다.

---

## ✨ 주요 기능

### 1. 📊 스프레드시트 스타일 편집
- **AG Grid** 기반의 직관적인 테이블 UI
- 셀 클릭으로 즉시 편집 가능
- 행 선택 시 하이라이트
- 오류 행 자동 표시 (빨간색 배경)

### 2. 🎬 실시간 타임스탬프 설정
- **현재 재생 시간 표시**: 상단에 실시간 업데이트
- **시작/종료 시간 설정**: 하단 버튼으로 원클릭 설정
- **자동 유효성 검증**:
  - 종료 시간 > 시작 시간
  - 현재 가사 시작 > 이전 가사 종료
  - 현재 가사 종료 < 다음 가사 시작

### 3. ⚡ YouTube 재생 속도 조절
-  0.25x ~ 2.0x (7단계)
- 슬로우 모션으로 정확한 타임스탬프 설정
- **모달 뒤의 YouTube 제어 가능**

### 4. 📥 가져오기/내보내기
- **TSV 다운로드**: 전체 가사를 TSV 파일로 저장
- **TSV 임포트**: 편집한 TSV 파일을 업로드하여 일괄 등록
- Excel에서 편집 가능

### 5. ✏️ 행 관리
- **행 추가**: 새 가사 추가 (자동으로 이전 종료 시간 이후로 설정)
- **행 삭제**: 선택한 행 삭제
- **순번 자동 재정렬**: 행 추가/삭제 시 자동 업데이트

---

## 🎮 사용 방법

### 기본 워크플로우

1. **편집기 열기**
   ```
   곡 선택 → "📝 가사 편집" 버튼 클릭
   ```

2. **YouTube 재생 속도 조절**
   ```
   상단의 재생 속도 버튼 (0.25x ~ 2.0x) 클릭
   ```

3. **가사 입력/수정**
   ```
   - 그리드의 셀을 클릭하여 직접 입력
   - 영어 가사, 한국어 번역 입력
   ```

4. **타임스탬프 설정**
   ```
   a) 행 선택 (클릭)
   b) YouTube 재생하며 시작 지점에서 "⏰ 시작 설정" 클릭
   c) 종료 지점에서 "⏱️ 종료 설정" 클릭
   d) 다음 행으로 이동하여 반복
   ```

5. **저장**
   ```
   하단 "💾 전체 저장" 버튼 클릭
   ```

---

## 📐 화면 구성

```
┌──────────────────────────────────────────────────────────┐
│ 📝 가사 편집: Imagine        🎬 23.45초            [✕]  │
├──────────────────────────────────────────────────────────┤
│ ⚡ 재생 속도: [0.25x] [0.5x] [0.75x] [1.0x] ... [2.0x]  │
├──────────────────────────────────────────────────────────┤
│ ┌────┬────────────────┬───────────┬───────┬─────────┐   │
│ │순번│ 영어 가사      │한국어 번역│시작(초)│종료(초)│   │
│ ├────┼────────────────┼───────────┼───────┼─────────┤   │
│ │ 1  │ Imagine...     │천국이...  │ 14.5  │ 18.0   │   │
│ │ 2  │ It's easy...   │노력하면..│ 18.0  │ 21.5   │   │
│ └────┴────────────────┴───────────┴───────┴─────────┘   │
├──────────────────────────────────────────────────────────┤
│ 📍 타임스탬프                                            │
│ [⏰ 시작 설정] [⏱️ 종료 설정] [▶️ 시작 이동] [▶️ 종료 이동]│
│                                                          │
│ ✏️ 편집                                                  │
│ [➕ 행 추가] [🗑️ 행 삭제]                              │
│                                                          │
│ 📥 가져오기/내보내기                                     │
│ [📥 TSV 다운로드] [📤 TSV 임포트]                       │
├──────────────────────────────────────────────────────────┤
│ 총 6개 가사 | 선택: 2번          [취소] [💾 전체 저장]  │
└──────────────────────────────────────────────────────────┘
```

---

## 🎯 타임스탬프 설정 팁

### 방법 1: 실시간 설정 (권장)
```
1. 재생 속도를 0.5x로 설정
2. YouTube 재생
3. 첫 번째 행 선택
4. 가사 시작 지점에 도달하면 "⏰ 시작 설정" 클릭
5. 가사 종료 지점에 도달하면 "⏱️ 종료 설정" 클릭
6. 다음 행 선택하여 반복
```

### 방법 2: 수동 입력
```
1. 그리드의 "시작 시간(초)" 셀 클릭
2. 숫자 입력 (예: 14.5)
3. "종료 시간(초)" 셀에도 입력
```

### 방법 3: TSV 편집
```
1. "📥 TSV 다운로드" 클릭
2. Excel에서 열어서 편집
3. "📤 TSV 임포트"로 업로드
```

---

## 🔒 유효성 검증 규칙

### 자동 검증
1. **종료 > 시작**: 종료 시간이 시작 시간보다 커야 함
2. **순차적 배치**: 다음 가사의 시작 시간은 이전 가사의 종료 시간보다 커야 함
3. **겹침 방지**: 가사 구간이 겹치지 않도록 자동 조정

### 오류 표시
- ❌ **빨간색 배경**: 유효성 검증 실패
- ⚠️ **오류 메시지**: 저장 시 구체적인 오류 위치 알림

---

## 📂 TSV 파일 형식

### 다운로드 파일 예시
```tsv
순번	영어가사	한국어번역	시작시간	종료시간
1	Imagine there's no heaven	천국이 없다고 상상해봐요	14.5	18.0
2	It's easy if you try	노력하면 쉬워요	18.0	21.5
3	No hell below us	우리 아래 지옥도 없고	21.5	24.5
```

### 임포트 주의사항
- 첫 번째 행은 헤더 (자동 무시)
- 탭(`\t`)으로 구분
- UTF-8 인코딩 사용

---

## ⌨️ 단축키

| 동작 | 방법 |
|------|------|
| 셀 편집 | 셀 클릭 또는 Enter |
| 다음 셀 | Tab |
| 행 선택 | 행 클릭 |
| 편집 취소 | Esc |
| 저장 | Ctrl/Cmd + S (추후 지원) |

---

## 🚀 성능 최적화

### AG Grid 설정
- **domLayout**: `normal` (가상 스크롤)
- **rowHeight**: 50px (자동 높이)
- **편집 모드**: 즉시 반영

### 메모리 절약
- **소스맵 비활성화**: `GENERATE_SOURCEMAP=false`
- **힙 크기 제한**: `NODE_OPTIONS="--max-old-space-size=512"`

---

## 🐛 문제 해결

### 문제: 타임스탬프 버튼이 작동하지 않음
**해결**: 행을 먼저 선택했는지 확인하세요.

### 문제: 저장 시 오류 발생
**해결**: 
1. 모든 가사에 영어 텍스트가 입력되었는지 확인
2. 타임스탬프 유효성 (종료 > 시작) 확인
3. 순차적 배치 (다음 시작 > 이전 종료) 확인

### 문제: TSV 임포트 실패
**해결**:
1. 파일이 UTF-8 인코딩인지 확인
2. 탭으로 구분되어 있는지 확인
3. 첫 행이 헤더인지 확인

---

## 📦 기술 스택

- **AG Grid Community**: 스프레드시트 UI
- **React**: 컴포넌트 프레임워크
- **YouTube Player API**: 재생 제어
- **Axios**: API 통신

---

## 🔄 데이터 흐름

```
1. 로드:
   GET /api/lyrics/song/:songId
   → lyrics 배열 → AG Grid rowData

2. 편집:
   사용자 입력 → cellValueChanged → 로컬 상태 업데이트

3. 저장:
   로컬 rowData → 유효성 검증
   → POST /api/lyrics/batch → DB 저장
   → 성공 메시지 → 모달 닫기

4. TSV 다운로드:
   rowData → TSV 문자열 → Blob → 다운로드

5. TSV 임포트:
   파일 업로드 → FileReader → 파싱 → rowData 업데이트
```

---

## 📝 향후 개선 사항

- [ ] 드래그 앤 드롭으로 행 순서 변경
- [ ] Ctrl+Z/Y로 실행 취소/다시 실행
- [ ] 자동 저장 (변경 후 3초)
- [ ] 키보드 단축키 확장
- [ ] 복수 행 선택 및 일괄 편집
- [ ] 타임스탬프 자동 감지 (음성 분석)

---

## 📞 문의

문제가 발생하거나 개선 제안이 있으시면 GitHub Issue를 생성해주세요.

**작성일**: 2026-01-12  
**버전**: 1.0.0  
**커밋**: 7ee6197
